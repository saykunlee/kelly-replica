### ============================================
### Auth API 테스트 (REST Client)
### ============================================
### JWT 기반 인증 시스템 테스트
### 사용법: 각 요청 위의 "Send Request" 클릭
### 또는 Ctrl+Alt+R (Windows/Linux) / Cmd+Alt+R (Mac)
### ============================================

@baseUrl = http://localhost:3005
@apiVersion = v1
@contentType = application/json

### ============================================
### 1. 로그인 (JWT 발급)
### ============================================

### 1-1. 정상 로그인
# @name login
POST {{baseUrl}}/api/{{apiVersion}}/auth/login
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "userid": "kellylee",
  "password": "uny2025"
}

### 1-2. 잘못된 비밀번호
POST {{baseUrl}}/api/{{apiVersion}}/auth/login
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "userid": "admin",
  "password": "wrongpassword"
}

### 1-3. 존재하지 않는 사용자
POST {{baseUrl}}/api/{{apiVersion}}/auth/login
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "userid": "nonexistent",
  "password": "password123"
}

### 1-4. 필수 필드 누락
POST {{baseUrl}}/api/{{apiVersion}}/auth/login
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "userid": "admin"
}


### ============================================
### 2. 인증된 사용자 정보 조회
### ============================================

### 2-1. 정상 조회 (Access Token 사용)
# 위의 login 요청에서 받은 토큰 사용
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Accept: {{contentType}}
Authorization: Bearer {{login.response.body.data.access_token}}

### 2-2. 토큰 없이 요청 (401 에러)
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Accept: {{contentType}}

### 2-3. 잘못된 토큰 (401 에러)
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Accept: {{contentType}}
Authorization: Bearer invalid_token_here


### ============================================
### 3. 토큰 검증
### ============================================

### 3-1. Access Token 검증
POST {{baseUrl}}/api/{{apiVersion}}/auth/verify
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "token": "{{login.response.body.data.access_token}}"
}

### 3-2. Authorization 헤더로 검증
POST {{baseUrl}}/api/{{apiVersion}}/auth/verify
Content-Type: {{contentType}}
Accept: {{contentType}}
Authorization: Bearer {{login.response.body.data.access_token}}

### 3-3. Refresh Token 검증
POST {{baseUrl}}/api/{{apiVersion}}/auth/verify
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "token": "{{login.response.body.data.refresh_token}}"
}


### ============================================
### 4. 토큰 갱신 (Refresh Token)
### ============================================

### 4-1. 정상 토큰 갱신
# @name refresh
POST {{baseUrl}}/api/{{apiVersion}}/auth/refresh
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "refresh_token": "{{login.response.body.data.refresh_token}}"
}

### 4-2. Refresh Token 없이 요청 (400 에러)
POST {{baseUrl}}/api/{{apiVersion}}/auth/refresh
Content-Type: {{contentType}}
Accept: {{contentType}}

{
}

### 4-3. 잘못된 Refresh Token (401 에러)
POST {{baseUrl}}/api/{{apiVersion}}/auth/refresh
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "refresh_token": "invalid_refresh_token"
}


### ============================================
### 5. 비밀번호 변경
### ============================================

### 5-1. 정상 비밀번호 변경
POST {{baseUrl}}/api/{{apiVersion}}/auth/change-password
Content-Type: {{contentType}}
Accept: {{contentType}}
Authorization: Bearer {{login.response.body.data.access_token}}

{
  "current_password": "admin1234",
  "new_password": "newPassword123!"
}

### 5-2. 인증 없이 요청 (401 에러)
POST {{baseUrl}}/api/{{apiVersion}}/auth/change-password
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "current_password": "admin1234",
  "new_password": "newPassword123!"
}

### 5-3. 현재 비밀번호 불일치 (401 에러)
POST {{baseUrl}}/api/{{apiVersion}}/auth/change-password
Content-Type: {{contentType}}
Accept: {{contentType}}
Authorization: Bearer {{login.response.body.data.access_token}}

{
  "current_password": "wrongpassword",
  "new_password": "newPassword123!"
}

### 5-4. 비밀번호가 너무 짧음 (422 에러)
POST {{baseUrl}}/api/{{apiVersion}}/auth/change-password
Content-Type: {{contentType}}
Accept: {{contentType}}
Authorization: Bearer {{login.response.body.data.access_token}}

{
  "current_password": "admin1234",
  "new_password": "123"
}


### ============================================
### 6. 로그아웃
### ============================================

### 6-1. 정상 로그아웃
POST {{baseUrl}}/api/{{apiVersion}}/auth/logout
Content-Type: {{contentType}}
Accept: {{contentType}}
Authorization: Bearer {{login.response.body.data.access_token}}


### ============================================
### 7. JWT 인증 흐름 전체 테스트
### ============================================

### Step 1: 로그인
# @name fullAuthTest
POST {{baseUrl}}/api/{{apiVersion}}/auth/login
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "userid": "testuser",
  "password": "testPassword123!"
}

### Step 2: 사용자 정보 조회
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Accept: {{contentType}}
Authorization: Bearer {{fullAuthTest.response.body.data.access_token}}

### Step 3: 토큰 갱신
# @name refreshedToken
POST {{baseUrl}}/api/{{apiVersion}}/auth/refresh
Content-Type: {{contentType}}
Accept: {{contentType}}

{
  "refresh_token": "{{fullAuthTest.response.body.data.refresh_token}}"
}

### Step 4: 새 토큰으로 사용자 정보 조회
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Accept: {{contentType}}
Authorization: Bearer {{refreshedToken.response.body.data.access_token}}

### Step 5: 로그아웃
POST {{baseUrl}}/api/{{apiVersion}}/auth/logout
Content-Type: {{contentType}}
Accept: {{contentType}}
Authorization: Bearer {{refreshedToken.response.body.data.access_token}}


### ============================================
### 8. 보호된 리소스 접근 테스트
### ============================================

### 8-1. 인증 없이 회원 목록 조회 (성공 - 공개 API)
GET {{baseUrl}}/api/{{apiVersion}}/members
Accept: {{contentType}}

### 8-2. 인증된 상태에서 회원 목록 조회
GET {{baseUrl}}/api/{{apiVersion}}/members
Accept: {{contentType}}
Authorization: Bearer {{login.response.body.data.access_token}}

### 8-3. 회원 생성 (인증 필요한 경우)
POST {{baseUrl}}/api/{{apiVersion}}/members
Content-Type: {{contentType}}
Accept: {{contentType}}
Authorization: Bearer {{login.response.body.data.access_token}}

{
  "mem_userid": "newauthuser",
  "mem_password": "securePassword123!",
  "mem_email": "authuser@example.com",
  "mem_username": "인증 테스트 사용자"
}


### ============================================
### 9. 에러 케이스 테스트
### ============================================

### 9-1. 만료된 토큰 (직접 만료된 토큰 입력 필요)
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Accept: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.expired.token

### 9-2. 잘못된 형식의 Authorization 헤더
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Accept: {{contentType}}
Authorization: InvalidFormat token_here

### 9-3. 토큰 없는 Authorization 헤더
GET {{baseUrl}}/api/{{apiVersion}}/auth/me
Accept: {{contentType}}
Authorization: Bearer


### ============================================
### 10. 토큰 정보 확인
### ============================================

### 10-1. Access Token 정보 표시
# 로그인 후 받은 토큰 정보 출력
# Response: {{login.response.body.data}}

### 10-2. 토큰 만료 시간 확인
# Access Token 만료: {{login.response.body.data.expires_in}} 초
# Refresh Token 만료: 7일 (604800초)


### ============================================
### 참고사항
### ============================================
# 1. @name을 사용하여 응답을 변수로 저장
# 2. {{variableName.response.body.data.field}} 형식으로 재사용
# 3. Access Token은 기본 1시간 (3600초) 유효
# 4. Refresh Token은 7일 (604800초) 유효
# 5. 토큰은 Authorization: Bearer <token> 형식으로 전달
# 6. httpOnly 쿠키 사용 시 Next.js에서 자동 처리
### ============================================

